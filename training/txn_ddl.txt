create or replace TRANSIENT TABLE EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS (
	TABLE_REFRESH_TIME TIMESTAMP_LTZ(9),
	ACTOR_ID VARCHAR(16777216),
	TXN_ID VARCHAR(16777216),
	CLIENT_ORDER_ID VARCHAR(16777216), 
	VENDOR_ORDER_ID VARCHAR(16777216),
	VENDOR_ACCOUNT_ID VARCHAR(16777216),
	POOL_TXN_ORDER_ID VARCHAR(16777216),
	WF_REQ_ID VARCHAR(16777216),
	TYPE VARCHAR(16777216),
	TXN_STATUS VARCHAR(16777216),
	TXN_CREATED_TIME_IST TIMESTAMP_NTZ(9),
	TXN_UPDATED_TIME_IST TIMESTAMP_NTZ(9),
	TXN_CREATED_DATE DATE,
	TXN_UPDATED_DATE DATE,
	TXN_CREATED_WEEK DATE,
	TXN_CREATED_MONTH DATE,
	TXN_AMOUNT_REQUESTED_USD NUMBER(38,6),
	TXN_AMOUNT_CONFIRMED_USD NUMBER(38,6),
	QTY_REQUESTED FLOAT,
	QTY_CONFIRMED FLOAT,
	STOCK_PRICE_AT_REQUESTED_USD FLOAT,
	STOCK_PRICE_AT_CONFIRMED_USD FLOAT,
	STOCK_SYMBOL VARCHAR(16777216),
	STOCK_ID VARCHAR(16777216),
	STOCK_EXCHANGE VARCHAR(16777216),
	STOCK_INTERNAL_STATUS VARCHAR(16777216),
	STOCK_CREATED_TIME_IST TIMESTAMP_NTZ(9),
	STOCK_UPDATED_TIME_IST TIMESTAMP_NTZ(9),
	MARKET_CATEGORY_NAME VARCHAR(16777216),
	STOCK_COMPANY_NAME VARCHAR(16777216),
	STOCK_INDUSTRY_ID VARCHAR(16777216),
	STOCK_INDUSTRY_GROUP_ID VARCHAR(16777216),
	STOCK_SECTOR_ID VARCHAR(16777216),
	WORKFLOW_STAGE VARCHAR(16777216),
	WORKFLOW_STATUS VARCHAR(16777216),
	WORKFLOW_VERSION VARCHAR(16777216),
	WORKFLOW_TYPE VARCHAR(16777216),
	ACCOUNT_ID VARCHAR(16777216),
	ACCOUNT_CREATED_TIME_IST TIMESTAMP_NTZ(9),
	DAYS_SINCE_ACCOUNT_CREATION NUMBER(9,0),
	FIRST_INVEST_TIME_IST TIMESTAMP_NTZ(9),
	NEW_REPEAT_USS VARCHAR(16777216),
	SWIFT_TXN_ORDER_ID VARCHAR(16777216),
	CATALOG_REF_ID VARCHAR(16777216),
	EXTERNAL_ORDER_ID VARCHAR(16777216),
	DELETED_AT_IST TIMESTAMP_NTZ(9),
	INVOICE_DETAILS VARCHAR(16777216),
	PAYMENT_INFO VARCHAR(16777216),
	ORDER_COMPLETION_TIME_SEC NUMBER(18,0),
	ORDER_COMPLETION_TIME_MINS NUMBER(18,0),
	ORDER_COMPLETION_TIME_HOUR NUMBER(9,0),
	ORDER_COMPLETION_TIME_DAYS NUMBER(9,0),
	PREV_CREATED_AT_IST TIMESTAMP_NTZ(9),
	DAYS_SINCE_PREV_INVESTED NUMBER(9,0)
    
);

COMMENT ON TABLE EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS IS 'This is the US Stocks transaction table which has very deep data about the US Stocks transactions table which has knowledge about Buy/ Sell orders, the amount of time it took for order completion, the stock where the order was placed, the information & invoice details of the payment, the workflow related details of the order and much more';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TABLE_REFRESH_TIME IS '{""comment"":""It is the time at which the table is refreshed. This not a very important field & can be ignore for most queries""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.ACTOR_ID IS '{ ""comment"": ""It is the identifier for a user across the organisation. This is a data point present across most tables in the organisation where there is a user action. Should be used as a joining key, since it represents the user identifier."",""examples"": [""35479187-1a5a-4dd2-80fd-695c2eb3f657"",""20188659-94f0-46b2-bfb8-a3bdb3605f0d"",""7b62cbda-a73f-4768-aa42-deced1ceaf5e""]}'
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_ID IS '{""comment"":""It is the identifier for a US Stocks Buy or sell transaction. This is the primary key of this table and will remain unique. This is typically used for mosr of our developer debugging use-cases"",""examples"": [""USSOusxpKagKfr240618"",""USSO48S8CJYuLE240618"",""USSO2ii2jnEdL7240718""]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.CLIENT_ORDER_ID IS  '{""comment"":""Client order ID is the order ID which is sometimes used for debugging anything on Android or iOS clients. It is also a primary key and will remain unique"",""examples"":[""1b8a9688-2b62-4718-9b2a-ffd786562669"",""715ce3d2-7bb0-4a72-babc-76342751bb32""]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.VENDOR_ORDER_ID IS  '{""comment"":""Vendor order ID is the order ID which is used for debugging orders with the downstream vendor. It is also a primary key and will remain unique""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.VENDOR_ACCOUNT_ID IS  '{""comment"":""This is unique identifier for a US Stocks brokerage account which is opened with the vendor. Typically used for debugging with the vendor""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.POOL_TXN_ORDER_ID IS '{""comment"":""This column can be ignore for this table""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.WF_REQ_ID IS '{""comment"":""This is a column often used for debugging by engineering team and checking the status of the workflows running behind the order. This is also a priamry key for this table""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TYPE IS '{""comment"":""Type describes whether the order is a Buy order or Sell order"",""examples"":[{""value"":""BUY"",""explanation"":""For when there is a buy order""},{""value"":""SELL"",""explanation"":""For when there is a sell order""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_STATUS IS '{""comment"":""Status describes the status of the order"",""examples"":[{""value"":""ORDER_CANCELED"",""explanation"":""When a buy or sell order is placed & then canceled by the user""},{""value"":""ORDER_SUCCESS"",""explanation"":""For when an order is fulfilled by vendor broker successfully""},{""value"":""ORDER_INITIATION_FAILED"",""explanation"":""For when order initiation with the vendor itself fails. This typically happens if there is a bug or a technical issue because orders dont get placed with vendor""},{""value"":""ORDER_FAILED"",""explanation"":""For when order gets placed but the order fails""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_CREATED_TIME_IST IS '{""comment"":""Time in IST when the order was placed by the user"", ""examples"":""2024-06-18T20:58:38.156Z""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_UPDATED_TIME_IST IS '{""comment"":""Time in IST when the order was most recently updated"", ""examples"":""2024-06-18T21:15:26.473Z""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_CREATED_DATE IS '{""comment"":""Date in IST when the order was placed by the user. This is used to aggregate over day. This is the most commonly used column for aggregating orders over a day"", ""examples"":""2024-06-18""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_UPDATED_DATE IS '{""comment"":""Date in IST when the order was most recently updated. This is used to aggregate over day"", ""examples"":""2024-06-18""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_CREATED_WEEK IS '{""comment"":""Date week in IST when the order was placed by the user. This is used to aggregate over week. This is the most commonly used column for aggregating orders over a week"", ""examples"":""2024-06-18""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_CREATED_MONTH IS '{""comment"":""Date month in IST when the order was placed by the user. This is used to aggregate over a month. This is the most commonly used column for aggregating orders over a month"", ""examples"":""2024-06-01""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_AMOUNT_REQUESTED_USD IS '{""comment"":""This is the transaction amount in USD currency for which the order was placed. This is typically the column that should be referred to when checking for the order amount"", ""examples"":""1.000000""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.TXN_AMOUNT_CONFIRMED_USD IS '{""comment"":""This is the transaction amount in USD currency for which the order was confirmed and fulfilled. This is usually the same as TXN_AMOUNT_REQUESTED"", ""examples"":""1.000000""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.QTY_REQUESTED IS '{""comment"":""This is the quantity of the stock for which the order is requested."", ""examples"":""0.00649645943""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.QTY_CONFIRMED IS '{""comment"":""This is the quantity of the stock for which the order is confirmed. The value of it will be 0 for when the order status is not successful"", ""examples"":""0.012829128""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_PRICE_AT_REQUESTED_USD IS '{""comment"":""This is the price of the stock in USD when the US Stock order was placed"",""examples"":""32.64""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_PRICE_AT_CONFIRMED_USD IS '{""comment"":""This is the price of the stock in USD when the US Stock order was confirmed. The value of it will be 0 for when the order status is not successful"",""examples"":""32.64""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_SYMBOL IS '{""comment"":""Describes the ticker/ symbol of the stock on the stock market"",""examples"":[{""value"":""MSFT"",""explanation"":""MSFT is the symbol for Microsoft""},{""value"":""TSLA"",""explanation"":""TSLA is the symbol for Tesla""},{""value"":""NVDA"",""explanation"":""NVDA is the symbol for Nvidia""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_ID IS '{""comment"":""This is the unique identifier of a particular ticker/ stock in the organisations tables"",""examples"":""USS221228gbUTWdXyTEawkWJlQA+4qg==""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_EXCHANGE IS '{""comment"":""This is the unique identifier of the exchange where the stock is listed on"",""examples"":[{""value"":""EXCHANGE_NAS"",""explanation"":""For NASDAQ""},{""value"":""EXCHANGE_ASE"",""explanation"":""For American Stock Exchange""},{""value"":""EXCHANGE_ARCA"",""explanation"":""For Arca Stock Exchange, mostly ETFs listed here""},{""value"":""EXCHANGE_NYSE"",""explanation"":""For New York Stock Exchange""},{""value"":""EXCHANGE_BATS"",""explanation"":""For BATS Stock Exchange, mostly ETFs listed here""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_INTERNAL_STATUS IS '{""comment"":""Internal status defines whether the stock is active or disabled for buy."",""examples"":[{""value"":""INTERNAL_STATUS_DISABLED_BUY"",""explanation"":""When the stock is disabled for buy""},{""value"":""INTERNAL_STATUS_AVAILABLE"",""explanation"":""When the stock is available for buy""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.MARKET_CATEGORY_NAME IS '{""comment"":""This defines the industry/ market category to which the stock for which the order is placed belongs."",""examples"":[{""value"":""Healthcare Plans""},{""value"":""Uranium""},{""value"":""Building Materials""},{""value"":""Broadcasting""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_COMPANY_NAME IS '{""comment"":""This defines the name of the company associated with the stock."",""examples"":[{""value"":""Occidental Petroleum Corp""},{""value"":""GitLab Inc""},{""value"":""Autodesk Inc""},{""value"":""LivePerson Inc""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_INDUSTRY_ID IS '{""comment"":""This defines the indsutry ID of the stock. It is an attirbute of a stock""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_INDUSTRY_GROUP_ID IS '{""comment"":""This defines the indsutry group ID of the stock. It is an attirbute of a stock""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.STOCK_SECTOR_ID IS '{""comment"":""This defines the sector ID of the stock. It is an attribute of a stock""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.WORKFLOW_STAGE IS '{""comment"":""Each of the orders will be associated with a workflow which is running in the background. This defines the stage at which the workflow is at Column is to be used when workflow specific information is required."",""examples"":[{""value"":""TRACK_ORDER"",""explanation"":""This is after the users order is placed whether it has been confirmed by the vendor broker""},{""value"":""SEND_SELL_ORDER"",""explanation"":""This is used for tracking whether the users sell order is placed""},{""value"":""SEND_BUY_ORDER"",""explanation"":""This is used for tracking whether the users buy order is placed""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.WORKFLOW_STATUS IS '{""comment"":""Each of the orders will be associated with a workflow which is running in the background. The workflow has various stages defined in WORKFLOW_STAGE column. This defines the status of the stage of the workflow."",""examples"":[{""value"":""MANUAL_INTERVENTION"",""explanation"":""When some error happens, a workflow goes into manual intervention for the engineer to fix manually""},{""value"":""SUCCESSFUL"",""explanation"":""Everything happened as expected""},{""value"":""CANCELED"",""explanation"":""Some user intervention happened to cancel the workflow""},{""value"":""FAILED"",""explanation"":""Some error occurred which is a terminal error""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.WORKFLOW_VERSION IS '{""comment"":""This defines version of the workflow"",""examples"":""v0""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.WORKFLOW_TYPE IS '{""comment"":""This defines the workflow type, which can be a Buy transaction, Sell transaction, or a reward transaction."",""examples"":[{""value"":""BUY_TRANSACTION"",""explanation"":""Represents a Buy transaction workflow""},{""value"":""SELL_TRANSACTION"",""explanation"":""Represents a Sell transaction workflow""},{""value"":""REWARD_TRANSACTION"",""explanation"":""Represents a reward transaction workflow. We should use this value when there are any stock reward related queries""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.ACCOUNT_ID IS '{""comment"":""This defines the account ID that we have defined internally for a users vendor broker account.""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.ACCOUNT_CREATED_TIME_IST IS '{""comment"":""This defines the time at which the users vendor broker account is create in IST (indian standard time)""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.DAYS_SINCE_ACCOUNT_CREATION IS '{""comment"":""This tells how many days it has been since the user has created the account""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.FIRST_INVEST_TIME_IST IS '{""comment"":""This tells the time in IST when a user invests in US Stocks for the first time during their lifetime"",""examples"":""2024-06-18T20:58:38.156Z""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.NEW_REPEAT_USS IS '{""comment"":""This tells whether for that order, the user has invested for the first time in their lifetime or they are a repeat user"",""examples"":[{""value"":""Repeat""},{""value"":""New""}]}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.USS_TRANSACTIONS.EXTERNAL_ORDER_ID IS '{""comment"":""This tells the order ID which is visible to the end user on their invoice. Hence the ID is used when there is a user issue on a specific order""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.ORDER_COMPLETION_TIME_SEC IS '{""comment"":""This tells in seconds how much time it took for the order to get fulfilled from order placement time""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.ORDER_COMPLETION_TIME_MINS IS '{""comment"":""This tells in minutes how much time it took for the order to get fulfilled from order placement time""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.ORDER_COMPLETION_TIME_HOUR IS '{""comment"":""This tells in hours how much time it took for the order to get fulfilled from order placement time""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.ORDER_COMPLETION_TIME_DAYS IS '{""comment"":""This tells in days how much time it took for the order to get fulfilled from order placement time""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.PREV_CREATED_AT_IST IS '{""comment"":""This tells the timestamp of the previous successful order placed by the user if the user has placed a order before this""}';
COMMENT ON COLUMN EPIFI_DATAMART_ALPACA.USSTOCKS.DAYS_SINCE_PREV_INVESTED IS '{""comment"":""This tells the number days since the previous successful order placed by the user if the user has placed a order before this""}';"